{{ define "main" }}
{{/* Listing Detail Page - Buyer-First Information Hierarchy */}}
<article class="min-h-screen anodized-metal-bg"
         x-data="listingPage()"
         x-init="initGallery()">

  <!-- ============================================
       SECTION 1: HERO GALLERY (Cinematic Ken Burns)
       ============================================ -->
  <section class="relative h-[70vh] overflow-hidden">
    <!-- Gallery Container -->
    <div class="absolute inset-0">
      <!-- Current Image with Ken Burns -->
      <template x-for="(photo, index) in photos" :key="photo.url">
        <div
          x-show="currentPhoto === index"
          x-transition:enter="transition ease-out duration-1000"
          x-transition:enter-start="opacity-0"
          x-transition:enter-end="opacity-100"
          x-transition:leave="transition ease-in duration-1000"
          x-transition:leave-start="opacity-100"
          x-transition:leave-end="opacity-0"
          class="absolute inset-0"
        >
          <img
            :src="photo.url + '?w=1920&h=1080&fit=crop'"
            :alt="photo.description || 'Property photo'"
            class="w-full h-full object-cover"
            :class="currentPhoto === index ? 'ken-burns-active' : ''"
          >
        </div>
      </template>

      <!-- Gradient overlays -->
      <div class="absolute inset-0 bg-gradient-to-t from-grand-dark via-transparent to-transparent"></div>
      <div class="absolute inset-0 bg-gradient-to-r from-grand-dark/40 to-transparent"></div>
    </div>

    <!-- Gallery Navigation (bottom-32 to clear the overlapping info card) -->
    <!-- Clicking arrows or dots opens the lightbox for full engagement -->
    <div class="absolute bottom-32 left-1/2 -translate-x-1/2 flex items-center gap-4 z-20">
      <button
        @click="openLightbox(); prevPhoto()"
        class="w-10 h-10 rounded-full bg-black/40 backdrop-blur-sm border border-white/20 flex items-center justify-center text-white hover:bg-black/60 transition-all"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      </button>

      <!-- Photo indicators -->
      <div class="flex gap-1.5">
        <template x-for="(photo, index) in photos.slice(0, 10)" :key="index">
          <button
            @click="goToPhoto(index); openLightbox()"
            :class="currentPhoto === index ? 'w-8 bg-white' : 'w-2 bg-white/40'"
            class="h-2 rounded-full transition-all duration-300"
          ></button>
        </template>
        <span x-show="photos.length > 10" class="text-white/60 text-sm ml-2" x-text="'+' + (photos.length - 10)"></span>
      </div>

      <button
        @click="openLightbox(); nextPhoto()"
        class="w-10 h-10 rounded-full bg-black/40 backdrop-blur-sm border border-white/20 flex items-center justify-center text-white hover:bg-black/60 transition-all"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </button>
    </div>

    <!-- Fullscreen button (below header: top-24 = 96px) -->
    <button
      @click="openLightbox()"
      class="absolute top-24 right-6 w-10 h-10 rounded-full bg-black/40 backdrop-blur-sm border border-white/20 flex items-center justify-center text-white hover:bg-black/60 transition-all z-20"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
      </svg>
    </button>

    <!-- Photo count (below header: top-24 = 96px) -->
    <div class="absolute top-24 left-6 px-3 py-1.5 rounded-lg bg-black/40 backdrop-blur-sm border border-white/20 z-20">
      <span class="text-white text-sm font-medium" x-text="(currentPhoto + 1) + ' / ' + photos.length"></span>
    </div>
  </section>

  <!-- ============================================
       SECTION 2: PRIMARY INFO (Price, Address, Stats)
       ============================================ -->
  <section class="relative -mt-24 z-10 px-4 sm:px-6 lg:px-8">
    <div class="max-w-6xl mx-auto">
      <div class="glass-card bg-grand-charcoal/80 rounded-2xl p-6 sm:p-8">
        <div class="sheen"></div>

        <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6">
          <!-- Left: Address & Price -->
          <div class="space-y-2">
            <h1 class="font-cinzel text-3xl sm:text-4xl lg:text-5xl text-white font-bold">
              {{ .Params.listPrice | lang.FormatNumber 0 | printf "$%s" }}
            </h1>
            <p class="text-xl sm:text-2xl text-grand-silver">
              {{ .Params.streetNumber }} {{ .Params.streetName }} {{ .Params.streetSuffix }}{{ with .Params.unitNumber }}, {{ . }}{{ end }}
            </p>
            <p class="text-grand-silver/70">
              {{ .Params.city }}, {{ .Params.stateOrProvince }} {{ .Params.postalCode }}
            </p>
            {{ with .Params.subdivisionName }}
            <p class="text-sm text-grand-silver/60">
              <span class="inline-flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                {{ . }}
              </span>
            </p>
            {{ end }}
          </div>

          <!-- Right: Key Stats -->
          <div class="flex flex-wrap gap-4 lg:gap-6">
            <div class="text-center px-4">
              <div class="text-2xl sm:text-3xl font-bold text-white">{{ .Params.bedroomsTotal }}</div>
              <div class="text-sm text-grand-silver/70">Beds</div>
            </div>
            <div class="text-center px-4">
              <div class="text-2xl sm:text-3xl font-bold text-white">{{ .Params.bathroomsTotalInteger }}</div>
              <div class="text-sm text-grand-silver/70">Baths</div>
            </div>
            <div class="text-center px-4">
              <div class="text-2xl sm:text-3xl font-bold text-white">{{ .Params.livingArea | lang.FormatNumber 0 }}</div>
              <div class="text-sm text-grand-silver/70">Sq Ft</div>
            </div>
            <div class="text-center px-4">
              <div class="text-2xl sm:text-3xl font-bold text-white">{{ .Params.yearBuilt }}</div>
              <div class="text-sm text-grand-silver/70">Year</div>
            </div>
            {{ with .Params.lotSizeAcres }}
            <div class="text-center px-4">
              <div class="text-2xl sm:text-3xl font-bold text-white">{{ . }}</div>
              <div class="text-sm text-grand-silver/70">Acres</div>
            </div>
            {{ end }}
          </div>
        </div>

        <!-- Quick badges -->
        <div class="flex flex-wrap gap-2 mt-6 pt-6 border-t border-white/10">
          {{ if .Params.poolPrivateYN }}
          <span class="px-3 py-1 rounded-full bg-blue-500/20 border border-blue-400/30 text-blue-300 text-sm">Pool</span>
          {{ end }}
          {{ if .Params.spaYN }}
          <span class="px-3 py-1 rounded-full bg-purple-500/20 border border-purple-400/30 text-purple-300 text-sm">Spa</span>
          {{ end }}
          {{ if .Params.fireplaceYN }}
          <span class="px-3 py-1 rounded-full bg-orange-500/20 border border-orange-400/30 text-orange-300 text-sm">Fireplace</span>
          {{ end }}
          {{ with .Params.garageSpaces }}
          <span class="px-3 py-1 rounded-full bg-gray-500/20 border border-gray-400/30 text-gray-300 text-sm">{{ . }}-Car Garage</span>
          {{ end }}
          {{ if .Params.newConstructionYN }}
          <span class="px-3 py-1 rounded-full bg-green-500/20 border border-green-400/30 text-green-300 text-sm">New Construction</span>
          {{ end }}
          {{ with .Params.view }}
          <span class="px-3 py-1 rounded-full bg-cyan-500/20 border border-cyan-400/30 text-cyan-300 text-sm">{{ replace . "," " & " }}</span>
          {{ end }}
        </div>
      </div>
    </div>
  </section>

  <!-- ============================================
       SECTION 3: DESCRIPTION & MONTHLY COSTS
       ============================================ -->
  <section class="py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-6xl mx-auto">
      <div class="grid lg:grid-cols-3 gap-8">
        <!-- Description (2 cols) -->
        <div class="lg:col-span-2 space-y-6">
          <h2 class="font-cinzel text-2xl text-white">About This Home</h2>
          <div class="prose prose-invert prose-lg max-w-none">
            <p class="text-grand-silver leading-relaxed">{{ .Params.publicRemarks }}</p>
          </div>

          {{ with .Params.directions }}
          <div class="mt-6 p-4 rounded-xl bg-grand-charcoal/50 border border-white/10">
            <h3 class="text-sm font-semibold text-grand-silver/70 uppercase tracking-wider mb-2">Directions</h3>
            <p class="text-grand-silver text-sm">{{ . }}</p>
          </div>
          {{ end }}
        </div>

        <!-- Monthly Costs Sidebar -->
        <div class="space-y-6">
          <div class="glass-card bg-grand-charcoal/60 rounded-2xl p-6">
            <div class="sheen"></div>
            <h3 class="font-cinzel text-xl text-white mb-4">Monthly Costs</h3>

            <div class="space-y-3">
              <!-- HOA -->
              {{ with .Params.associationFee }}
              <div class="flex justify-between items-center text-grand-silver">
                <span class="text-sm">HOA{{ with $.Params.associationName }} ({{ . }}){{ end }}</span>
                <span class="font-semibold">${{ . | lang.FormatNumber 0 }}/mo</span>
              </div>
              {{ end }}

              {{ with .Params.associationFee2 }}
              <div class="flex justify-between items-center text-grand-silver">
                <span class="text-sm">Secondary HOA{{ with $.Params.associationName2 }} ({{ . }}){{ end }}</span>
                <span class="font-semibold">${{ . | lang.FormatNumber 0 }}/mo</span>
              </div>
              {{ end }}

              <!-- Tax -->
              {{ with .Params.taxAnnualAmount }}
              <div class="flex justify-between items-center text-grand-silver">
                <span class="text-sm">Property Tax (est.)</span>
                <span class="font-semibold">${{ div . 12 | lang.FormatNumber 0 }}/mo</span>
              </div>
              {{ end }}

              <div class="border-t border-white/10 pt-3 mt-3">
                <p class="text-xs text-grand-silver/60">*Estimates. Actual costs may vary.</p>
              </div>
            </div>
          </div>

          <!-- CTA -->
          <div class="glass-card bg-grand-charcoal/60 rounded-2xl p-6">
            <div class="sheen"></div>
            <h3 class="font-cinzel text-xl text-white mb-4">Schedule a Showing</h3>
            <p class="text-grand-silver/80 text-sm mb-4">Interested in this property? Contact us to schedule a private tour.</p>
            <a href="/contact/?listing={{ .Params.listingId }}"
               class="block w-full text-center py-3 px-4 rounded-lg bg-white text-grand-dark font-semibold hover:bg-grand-silver transition-colors">
              Contact Agent
            </a>
          </div>

          {{ with .Params.virtualTourURLUnbranded }}
          <a href="{{ . }}" target="_blank" rel="noopener"
             class="block w-full text-center py-3 px-4 rounded-lg bg-grand-charcoal border border-white/20 text-white font-semibold hover:bg-grand-steel transition-colors">
            Virtual Tour
          </a>
          {{ end }}
        </div>
      </div>
    </div>
  </section>

  <!-- ============================================
       SECTION 4: PROPERTY DETAILS
       ============================================ -->
  <section class="py-12 px-4 sm:px-6 lg:px-8 border-t border-white/10">
    <div class="max-w-6xl mx-auto">
      <h2 class="font-cinzel text-2xl text-white mb-8">Property Details</h2>

      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Interior -->
        <div class="space-y-4">
          <h3 class="text-sm font-semibold text-grand-silver/70 uppercase tracking-wider">Interior</h3>
          <dl class="space-y-2">
            {{ with .Params.flooring }}
            <div class="flex justify-between text-sm">
              <dt class="text-grand-silver/70">Flooring</dt>
              <dd class="text-grand-silver">{{ replace . "," ", " }}</dd>
            </div>
            {{ end }}
            {{ with .Params.heating }}
            <div class="flex justify-between text-sm">
              <dt class="text-grand-silver/70">Heating</dt>
              <dd class="text-grand-silver">{{ replace . "," ", " }}</dd>
            </div>
            {{ end }}
            {{ with .Params.cooling }}
            <div class="flex justify-between text-sm">
              <dt class="text-grand-silver/70">Cooling</dt>
              <dd class="text-grand-silver">{{ replace . "," ", " }}</dd>
            </div>
            {{ end }}
            {{ with .Params.fireplacesTotal }}
            <div class="flex justify-between text-sm">
              <dt class="text-grand-silver/70">Fireplaces</dt>
              <dd class="text-grand-silver">{{ . }}</dd>
            </div>
            {{ end }}
            {{ with .Params.stories }}
            <div class="flex justify-between text-sm">
              <dt class="text-grand-silver/70">Stories</dt>
              <dd class="text-grand-silver">{{ . }}</dd>
            </div>
            {{ end }}
          </dl>
        </div>

        <!-- Exterior -->
        <div class="space-y-4">
          <h3 class="text-sm font-semibold text-grand-silver/70 uppercase tracking-wider">Exterior & Lot</h3>
          <dl class="space-y-2">
            {{ with .Params.lotSizeSquareFeet }}
            <div class="flex justify-between text-sm">
              <dt class="text-grand-silver/70">Lot Size</dt>
              <dd class="text-grand-silver">{{ . | lang.FormatNumber 0 }} sq ft</dd>
            </div>
            {{ end }}
            {{ with .Params.parkingFeatures }}
            <div class="flex justify-between text-sm">
              <dt class="text-grand-silver/70">Parking</dt>
              <dd class="text-grand-silver text-right max-w-[180px]">{{ replace . "," ", " }}</dd>
            </div>
            {{ end }}
            {{ with .Params.waterSource }}
            <div class="flex justify-between text-sm">
              <dt class="text-grand-silver/70">Water</dt>
              <dd class="text-grand-silver">{{ . }}</dd>
            </div>
            {{ end }}
            {{ with .Params.sewer }}
            <div class="flex justify-between text-sm">
              <dt class="text-grand-silver/70">Sewer</dt>
              <dd class="text-grand-silver">{{ replace . "," ", " }}</dd>
            </div>
            {{ end }}
          </dl>
        </div>

        <!-- Community -->
        <div class="space-y-4">
          <h3 class="text-sm font-semibold text-grand-silver/70 uppercase tracking-wider">Community</h3>
          <dl class="space-y-2">
            {{ with .Params.associationName }}
            <div class="flex justify-between text-sm">
              <dt class="text-grand-silver/70">Association</dt>
              <dd class="text-grand-silver">{{ . }}</dd>
            </div>
            {{ end }}
            {{ with .Params.securityFeatures }}
            <div class="flex justify-between text-sm">
              <dt class="text-grand-silver/70">Security</dt>
              <dd class="text-grand-silver text-right max-w-[180px]">{{ replace . "," ", " }}</dd>
            </div>
            {{ end }}
            {{ with .Params.communityFeatures }}
            <div class="flex justify-between text-sm">
              <dt class="text-grand-silver/70">Amenities</dt>
              <dd class="text-grand-silver text-right max-w-[180px]">{{ replace . "," ", " }}</dd>
            </div>
            {{ end }}
          </dl>
        </div>
      </div>

      <!-- Appliances & Features (expandable) -->
      {{ with .Params.appliances }}
      <div class="mt-8 p-4 rounded-xl bg-grand-charcoal/30 border border-white/10">
        <h3 class="text-sm font-semibold text-grand-silver/70 uppercase tracking-wider mb-3">Appliances</h3>
        <p class="text-grand-silver text-sm">{{ replace . "," ", " }}</p>
      </div>
      {{ end }}

      {{ with .Params.interiorFeatures }}
      <div class="mt-4 p-4 rounded-xl bg-grand-charcoal/30 border border-white/10">
        <h3 class="text-sm font-semibold text-grand-silver/70 uppercase tracking-wider mb-3">Interior Features</h3>
        <p class="text-grand-silver text-sm">{{ replace . "," ", " }}</p>
      </div>
      {{ end }}

      {{ with .Params.exteriorFeatures }}
      <div class="mt-4 p-4 rounded-xl bg-grand-charcoal/30 border border-white/10">
        <h3 class="text-sm font-semibold text-grand-silver/70 uppercase tracking-wider mb-3">Exterior Features</h3>
        <p class="text-grand-silver text-sm">{{ replace . "," ", " }}</p>
      </div>
      {{ end }}

      {{ with .Params.associationAmenities }}
      <div class="mt-4 p-4 rounded-xl bg-grand-charcoal/30 border border-white/10">
        <h3 class="text-sm font-semibold text-grand-silver/70 uppercase tracking-wider mb-3">Association Amenities</h3>
        <p class="text-grand-silver text-sm">{{ replace . "," ", " }}</p>
      </div>
      {{ end }}
    </div>
  </section>

  <!-- ============================================
       SECTION 5: SCHOOLS
       ============================================ -->
  {{ if or .Params.elementarySchool .Params.middleOrJuniorSchool .Params.highSchool }}
  <section class="py-12 px-4 sm:px-6 lg:px-8 border-t border-white/10">
    <div class="max-w-6xl mx-auto">
      <h2 class="font-cinzel text-2xl text-white mb-8">Schools</h2>

      <div class="grid sm:grid-cols-3 gap-6">
        {{ with .Params.elementarySchool }}
        <div class="glass-card bg-grand-charcoal/40 rounded-xl p-5">
          <div class="sheen"></div>
          <div class="text-xs text-grand-silver/60 uppercase tracking-wider mb-2">Elementary</div>
          <div class="text-grand-silver font-medium">{{ . }}</div>
        </div>
        {{ end }}

        {{ with .Params.middleOrJuniorSchool }}
        <div class="glass-card bg-grand-charcoal/40 rounded-xl p-5">
          <div class="sheen"></div>
          <div class="text-xs text-grand-silver/60 uppercase tracking-wider mb-2">Middle School</div>
          <div class="text-grand-silver font-medium">{{ . }}</div>
        </div>
        {{ end }}

        {{ with .Params.highSchool }}
        <div class="glass-card bg-grand-charcoal/40 rounded-xl p-5">
          <div class="sheen"></div>
          <div class="text-xs text-grand-silver/60 uppercase tracking-wider mb-2">High School</div>
          <div class="text-grand-silver font-medium">{{ . }}</div>
        </div>
        {{ end }}
      </div>
    </div>
  </section>
  {{ end }}

  <!-- ============================================
       SECTION 6: MAP
       ============================================ -->
  {{ if and .Params.latitude .Params.longitude }}
  <section class="py-12 px-4 sm:px-6 lg:px-8 border-t border-white/10">
    <div class="max-w-6xl mx-auto">
      <h2 class="font-cinzel text-2xl text-white mb-8">Location</h2>

      <div class="rounded-2xl overflow-hidden h-[400px] border border-white/10">
        <iframe
          src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d3000!2d{{ .Params.longitude }}!3d{{ .Params.latitude }}!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sus!4v1234567890"
          width="100%"
          height="100%"
          style="border:0;"
          allowfullscreen=""
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade">
        </iframe>
      </div>
    </div>
  </section>
  {{ end }}

  <!-- ============================================
       SECTION 7: IDX COMPLIANCE FOOTER
       ============================================ -->
  <section class="py-8 px-4 sm:px-6 lg:px-8 border-t border-white/10 bg-grand-darker">
    <div class="max-w-6xl mx-auto">
      <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4 text-xs text-grand-silver/60">
        <img src="/images/mls-logo.png" alt="MLS Logo" class="h-8 opacity-60" onerror="this.style.display='none'">
        <div class="space-y-1">
          <p>
            Listing provided by <strong class="text-grand-silver">{{ .Params.listOfficeName }}</strong>
            {{ with .Params.listAgentFullName }} | Agent: <strong class="text-grand-silver">{{ . }}</strong>{{ end }}
          </p>
          <p>
            MLS# {{ .Params.listingId }} |
            Listed: {{ with .Params.listingContractDate }}{{ . }}{{ else }}N/A{{ end }} |
            Days on Market: {{ .Params.daysOnMarket | default "N/A" }}
          </p>
          <p>
            Data last updated: {{ with .Params.modificationTimestamp }}{{ dateFormat "January 2, 2006" . }}{{ end }}
          </p>
          <p class="mt-2">
            The data relating to real estate for sale on this website comes from the Internet Data Exchange (IDX)
            program of the Greater Las Vegas Association of REALTORS&reg;. Real estate listings held by brokerage
            firms other than Grand Prix Realty are marked with the IDX logo. All information deemed reliable but
            not guaranteed.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- ============================================
       LIGHTBOX MODAL - Full screen, covers everything
       ============================================ -->
  <div
    x-show="lightboxOpen"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-100"
    x-transition:leave-end="opacity-0"
    style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 99999; background: #000; display: flex; align-items: center; justify-content: center;"
    @keydown.escape.window="lightboxOpen = false"
    @keydown.left.window="if(lightboxOpen) prevPhoto()"
    @keydown.right.window="if(lightboxOpen) nextPhoto()"
  >
    <!-- Close button - exact same structure as hamburger menu X -->
    <button
      @click="lightboxOpen = false"
      style="position: absolute; top: 24px; right: 24px; padding: 8px; cursor: pointer; background: transparent; border: none; z-index: 10; display: flex; flex-direction: column; gap: 5px;"
      aria-label="Close gallery"
    >
      <span style="display: block; width: 24px; height: 3px; background: white; transform: rotate(45deg) translate(7px, 7px);"></span>
      <span style="display: block; width: 24px; height: 3px; background: white; opacity: 0;"></span>
      <span style="display: block; width: 24px; height: 3px; background: white; transform: rotate(-45deg) translate(7px, -7px);"></span>
    </button>

    <!-- Navigation - Previous -->
    <button
      @click="prevPhoto()"
      style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); width: 48px; height: 48px; border-radius: 50%; background: rgba(255,255,255,0.1); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;"
    >
      <svg style="width: 24px; height: 24px; color: white;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </button>

    <!-- Navigation - Next -->
    <button
      @click="nextPhoto()"
      style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%); width: 48px; height: 48px; border-radius: 50%; background: rgba(255,255,255,0.1); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;"
    >
      <svg style="width: 24px; height: 24px; color: white;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </button>

    <!-- Image -->
    <div style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; padding: 60px 80px;">
      <img
        :src="photos[currentPhoto]?.url"
        :alt="photos[currentPhoto]?.description || 'Property photo'"
        style="max-width: 100%; max-height: 100%; object-fit: contain;"
      >
    </div>

    <!-- Counter -->
    <div style="position: absolute; bottom: 16px; left: 50%; transform: translateX(-50%); padding: 8px 16px; border-radius: 9999px; background: rgba(255,255,255,0.1); color: white; font-size: 14px;">
      <span x-text="(currentPhoto + 1) + ' / ' + photos.length"></span>
      <span x-show="photos[currentPhoto]?.description" style="margin-left: 8px; color: rgba(255,255,255,0.6);" x-text="'â€” ' + photos[currentPhoto]?.description"></span>
    </div>
  </div>
</article>

<!-- Ken Burns CSS -->
<style>
  @keyframes kenBurns {
    0% {
      transform: scale(1) translate(0, 0);
    }
    100% {
      transform: scale(1.08) translate(-1%, -1%);
    }
  }

  .ken-burns-active {
    animation: kenBurns 8s ease-out forwards;
  }
</style>

<!-- Alpine.js Component -->
<script>
  function listingPage() {
    return {
      photos: [],
      currentPhoto: 0,
      lightboxOpen: false,
      autoPlayInterval: null,

      initGallery() {
        // Photos will be injected from Hugo data
        this.photos = {{ .Params.media | jsonify | safeJS }};

        // Start auto-rotation
        if (this.photos.length > 0) {
          this.startAutoPlay();
        }
      },

      startAutoPlay() {
        this.autoPlayInterval = setInterval(() => {
          if (!this.lightboxOpen) {
            this.nextPhoto();
          }
        }, 6000); // 6 seconds per photo
      },

      stopAutoPlay() {
        if (this.autoPlayInterval) {
          clearInterval(this.autoPlayInterval);
        }
      },

      nextPhoto() {
        this.currentPhoto = (this.currentPhoto + 1) % this.photos.length;
      },

      prevPhoto() {
        this.currentPhoto = (this.currentPhoto - 1 + this.photos.length) % this.photos.length;
      },

      goToPhoto(index) {
        this.currentPhoto = index;
        // Reset autoplay timer when manually navigating
        this.stopAutoPlay();
        this.startAutoPlay();
      },

      openLightbox() {
        this.currentPhoto = 0; // Always start from photo #1
        this.lightboxOpen = true;
        this.stopAutoPlay();
      }
    }
  }
</script>
{{ end }}
